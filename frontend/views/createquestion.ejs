<%- include('./include/header.ejs') %>
<%- include('./include/navbar.ejs') %>
<link rel="stylesheet" href="../assets/style/createquestion.css">
   <!-- Main Content -->
    <main class="main-content">
      <!-- Page Header -->
      <div class="page-header">
        <div class="page-header-content">
          <h1>Criar Nova Questão</h1>
          <p>Preencha os campos abaixo para adicionar uma nova questão ao banco de dados</p>
        </div>
        <a href="/questoes" class="btn-secondary">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="19" y1="12" x2="5" y2="12"/>
            <polyline points="12,19 5,12 12,5"/>
          </svg>
          Voltar
        </a>
      </div>

      <!-- Form Container -->
      <div class="form-container">
        <form action="/criar-questao" method="POST" id="createQuestionForm">
            <input type="hidden" name="_csrf" value="<%= csrfToken %>">
            <input type="hidden" name="creatorId" value="<%= user.id %>" >
          <div class="form-row">
            <div class="form-group">
              <label for="title">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/>
                  <path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/>
                </svg>
                Título da Questão
              </label>
              <input type="text" id="title" name="title" placeholder="Ex: Questão sobre Revolução Francesa" required>
            </div>
            <div class="form-group">
              <label for="discipline">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M4 19.5A2.5 2.5 0 016.5 17H20"/>
                  <path d="M6.5 2H20v20H6.5A2.5 2.5 0 014 19.5v-15A2.5 2.5 0 016.5 2z"/>
                </svg>
                Disciplina
              </label>
              <select id="discipline" name="discipline" required>
                <option value="" disabled selected>Selecione uma disciplina</option>
                <option value="por">Português</option>
                <option value="mat">Matemática</option>
                <option value="his">História</option>
                <option value="geo">Geografia</option>
                <option value="fis">Física</option>
                <option value="qui">Química</option>
                <option value="bio">Biologia</option>
                <option value="ing">Inglês</option>
                <option value="esp">Espanhol</option>
                <option value="fil">Filosofia</option>
                <option value="soc">Sociologia</option>
                <option value="art">Artes</option>
                <option value="edu">Educação Física</option>
                <option value="lit">Literatura</option>
                <option value="red">Redação</option>
              </select>
            </div>
          </div>

          <!-- Row 2: Difficulty -->
          <div class="form-group">
            <label>
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polygon points="12,2 15.09,8.26 22,9.27 17,14.14 18.18,21.02 12,17.77 5.82,21.02 7,14.14 2,9.27 8.91,8.26"/>
              </svg>
              Nível de Dificuldade
            </label>
            <div class="difficulty-options">
              <label class="difficulty-option">
                <input type="radio" name="difficult" value="FACIL" required>
                <span class="difficulty-card easy">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/>
                    <path d="M8 14s1.5 2 4 2 4-2 4-2"/>
                    <line x1="9" y1="9" x2="9.01" y2="9"/>
                    <line x1="15" y1="9" x2="15.01" y2="9"/>
                  </svg>
                  <span class="difficulty-label">Fácil</span>
                  <span class="difficulty-desc">Questões básicas</span>
                </span>
              </label>
              <label class="difficulty-option">
                <input type="radio" name="difficult" value="MEDIO">
                <span class="difficulty-card medium">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/>
                    <line x1="8" y1="15" x2="16" y2="15"/>
                    <line x1="9" y1="9" x2="9.01" y2="9"/>
                    <line x1="15" y1="9" x2="15.01" y2="9"/>
                  </svg>
                  <span class="difficulty-label">Médio</span>
                  <span class="difficulty-desc">Nível intermediário</span>
                </span>
              </label>
              <label class="difficulty-option">
                <input type="radio" name="difficult" value="DIFICIL">
                <span class="difficulty-card hard">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/>
                    <path d="M16 16s-1.5-2-4-2-4 2-4 2"/>
                    <line x1="9" y1="9" x2="9.01" y2="9"/>
                    <line x1="15" y1="9" x2="15.01" y2="9"/>
                  </svg>
                  <span class="difficulty-label">Difícil</span>
                  <span class="difficulty-desc">Questões avançadas</span>
                </span>
              </label>
            </div>
          </div>

          <!-- Row 3: Content -->
          <div class="form-group">
            <label for="content">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/>
                <polyline points="14,2 14,8 20,8"/>
                <line x1="16" y1="13" x2="8" y2="13"/>
                <line x1="16" y1="17" x2="8" y2="17"/>
                <polyline points="10,9 9,9 8,9"/>
              </svg>
              Conteúdo / Texto Base 
            </label>
            <textarea id="content" name="content" rows="4" placeholder="Texto de apoio, contexto histórico, enunciado longo, fragmento de livro, etc."></textarea>
            <span class="input-hint">Use para adicionar contexto à questão.</span>
          </div>

          <!-- Row 4: Question Command -->
          <div class="form-group">
            <label for="question_command">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <path d="M9.09 9a3 3 0 015.83 1c0 2-3 3-3 3"/>
                <line x1="12" y1="17" x2="12.01" y2="17"/>
              </svg>
              Comando da Questão
            </label>
            <textarea id="question_command" name="question_command" rows="2" placeholder="Ex: Com base no texto acima, assinale a alternativa correta:" required></textarea>
          </div>

          <!-- Row 5: Alternatives -->
          <div class="form-group">
            <label>
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="8" y1="6" x2="21" y2="6"/>
                <line x1="8" y1="12" x2="21" y2="12"/>
                <line x1="8" y1="18" x2="21" y2="18"/>
                <line x1="3" y1="6" x2="3.01" y2="6"/>
                <line x1="3" y1="12" x2="3.01" y2="12"/>
                <line x1="3" y1="18" x2="3.01" y2="18"/>
              </svg>
              Alternativas
            </label>
            <div class="alternatives-container">
              <div class="alternative-input">
                <span class="alternative-letter">A</span>
                <input type="text" name="alternatives[]" id="alt0" placeholder="Digite a alternativa A" required>
                <label class="correct-radio" title="Marcar como correta">
                  <input type="radio" name="correct_alternative" value="0" required>
                  <span class="radio-custom">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <polyline points="20,6 9,17 4,12"/>
                    </svg>
                  </span>
                </label>
              </div>
              <div class="alternative-input">
                <span class="alternative-letter">B</span>
                <input type="text" name="alternatives[]" id="alt1" placeholder="Digite a alternativa B" required>
                <label class="correct-radio" title="Marcar como correta">
                  <input type="radio" name="correct_alternative" value="1">
                  <span class="radio-custom">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <polyline points="20,6 9,17 4,12"/>
                    </svg>
                  </span>
                </label>
              </div>
              <div class="alternative-input">
                <span class="alternative-letter">C</span>
                <input type="text" name="alternatives[]" id="alt2" placeholder="Digite a alternativa C" required>
                <label class="correct-radio" title="Marcar como correta">
                  <input type="radio" name="correct_alternative" value="2">
                  <span class="radio-custom">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <polyline points="20,6 9,17 4,12"/>
                    </svg>
                  </span>
                </label>
              </div>
              <div class="alternative-input">
                <span class="alternative-letter">D</span>
                <input type="text" name="alternatives[]" id="alt3" placeholder="Digite a alternativa D" required>
                <label class="correct-radio" title="Marcar como correta">
                  <input type="radio" name="correct_alternative" value="3">
                  <span class="radio-custom">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <polyline points="20,6 9,17 4,12"/>
                    </svg>
                  </span>
                </label>
              </div>
              <div class="alternative-input">
                <span class="alternative-letter">E</span>
                <input type="text" name="alternatives[]" id="alt4" placeholder="Digite a alternativa E" required>
                <label class="correct-radio" title="Marcar como correta">
                  <input type="radio" name="correct_alternative" value="4">
                  <span class="radio-custom">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <polyline points="20,6 9,17 4,12"/>
                    </svg>
                  </span>
                </label>
              </div>
            </div>
            <span class="input-hint">Clique no ícone de check para marcar a alternativa correta</span>
          </div>

          <!-- Form Actions -->
          <div class="form-actions">
            <button type="button" class="btn-secondary" onclick="window.location.href='/questoes'">
              Cancelar
            </button>
            <button type="submit" class="btn-primary">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"/>
                <polyline points="17,21 17,13 7,13 7,21"/>
                <polyline points="7,3 7,8 15,8"/>
              </svg>
              Salvar Questão
            </button>
          </div>
        </form>
      </div>

      <!-- Preview Section -->
      <div class="preview-section">
        <div class="preview-header">
          <h2>
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
              <circle cx="12" cy="12" r="3"/>
            </svg>
            Pré-visualização
          </h2>
          <span class="preview-badge">Tempo real</span>
        </div>
        <div class="preview-card">
          <div class="question-card">
            <div class="question-card-header">
              <span class="question-category" id="previewDiscipline">Disciplina</span>
              <span class="question-difficulty medium" id="previewDifficulty">Médio</span>
            </div>
            <h3 class="preview-title" id="previewTitle">Título da questão aparecerá aqui</h3>
            <p class="preview-content" id="previewContent">O conteúdo/texto base aparecerá aqui (se houver).</p>
            <p class="question-text" id="previewCommand">O comando da questão aparecerá aqui.</p>
            <div class="question-options" id="previewOptions">
              <button class="option">
                <span class="option-letter">A</span>
                <span class="option-text">Alternativa A</span>
              </button>
              <button class="option">
                <span class="option-letter">B</span>
                <span class="option-text">Alternativa B</span>
              </button>
              <button class="option">
                <span class="option-letter">C</span>
                <span class="option-text">Alternativa C</span>
              </button>
              <button class="option">
                <span class="option-letter">D</span>
                <span class="option-text">Alternativa D</span>
              </button>
              <button class="option">
                <span class="option-letter">E</span>
                <span class="option-text">Alternativa E</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <script>
    // =========================
// Live Preview
// =========================
const titleInput = document.getElementById('title');
const disciplineInput = document.getElementById('discipline');
const contentInput = document.getElementById('content');
const commandInput = document.getElementById('question_command');

const difficultyInputs = document.querySelectorAll('input[name="difficult"]');
const correctInputs = document.querySelectorAll('input[name="correct_alternative"]');

const previewTitle = document.getElementById('previewTitle');
const previewDiscipline = document.getElementById('previewDiscipline');
const previewContent = document.getElementById('previewContent');
const previewCommand = document.getElementById('previewCommand');
const previewDifficulty = document.getElementById('previewDifficulty');
const optionsContainer = document.getElementById('previewOptions');

const letters = ['A', 'B', 'C', 'D', 'E'];



function updatePreview() {
  // Title
  previewTitle.textContent = titleInput.value || 'Título da questão aparecerá aqui';

  // Discipline
  previewDiscipline.textContent = disciplineInput.value || 'Disciplina';

  // Content
  if (contentInput.value) {
    previewContent.textContent = contentInput.value;
    previewContent.style.display = 'block';
  } else {
    previewContent.style.display = 'none';
  }

  // Command
  previewCommand.textContent = commandInput.value || 'O comando da questão aparecerá aqui.';

  // Difficulty
  const checkedDifficulty = document.querySelector('input[name="difficult"]:checked');
  if (checkedDifficulty) {
    const value = checkedDifficulty.value;
    previewDifficulty.textContent = value === 'FACIL' ? 'Fácil' : value === 'MEDIO' ? 'Médio' : 'Difícil';
    previewDifficulty.className = 'question-difficulty ' + (value === 'FACIL' ? 'easy' : value === 'MEDIO' ? 'medium' : 'hard');
  }

  // Alternatives
  optionsContainer.innerHTML = '';
  const checkedCorrect = document.querySelector('input[name="correct_alternative"]:checked');

  for (let i = 0; i < 5; i++) {
    const input = document.getElementById(`alt${i}`);
    if (!input) continue;

    const isCorrect = checkedCorrect && Number(checkedCorrect.value) === i;

    const button = document.createElement('button');
    button.type = 'button';
    button.className = 'option' + (isCorrect ? ' correct' : '');

    const letterSpan = document.createElement('span');
    letterSpan.className = 'option-letter';
    letterSpan.textContent = letters[i];

    const textSpan = document.createElement('span');
    textSpan.className = 'option-text';
    textSpan.textContent = input.value || `Alternativa ${letters[i]}`;

    button.appendChild(letterSpan);
    button.appendChild(textSpan);

    optionsContainer.appendChild(button);
  }
}

// =========================
// Event Listeners
// =========================
[titleInput, disciplineInput, contentInput, commandInput].forEach(input => {
  input?.addEventListener('input', updatePreview); // <- input para tempo real
});

difficultyInputs.forEach(input => input.addEventListener('input', updatePreview)); // <- input para radio

correctInputs.forEach(input => input.addEventListener('input', updatePreview));

for (let i = 0; i < 5; i++) {
  const altInput = document.getElementById(`alt${i}`);
  altInput?.addEventListener('input', updatePreview);
}

// Inicializa preview
updatePreview();

  </script>


<%- include('./include/footer.ejs') %>